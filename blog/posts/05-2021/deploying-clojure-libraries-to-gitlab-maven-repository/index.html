<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.25.1"/><title data-react-helmet="true">Deploying Clojure libraries to gitlab maven repository | shamin.github.io</title><link data-react-helmet="true" rel="preconnect" href="https://fonts.gstatic.com"/><link data-react-helmet="true" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500&amp;display=swap" rel="stylesheet"/><meta data-react-helmet="true" name="description" content="Shamin&#x27;s blog"/><meta data-react-helmet="true" property="og:title" content="Deploying Clojure libraries to gitlab maven repository"/><meta data-react-helmet="true" property="og:description" content="Shamin&#x27;s blog"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@shamin"/><meta data-react-helmet="true" name="twitter:title" content="Deploying Clojure libraries to gitlab maven repository"/><meta data-react-helmet="true" name="twitter:description" content="Shamin&#x27;s blog"/><link rel="icon" href="/favicon-32x32.png?v=7a885a4e45884851e6c0a7e8dd3faecf" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#161D2E"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=7a885a4e45884851e6c0a7e8dd3faecf"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=7a885a4e45884851e6c0a7e8dd3faecf"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=7a885a4e45884851e6c0a7e8dd3faecf"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=7a885a4e45884851e6c0a7e8dd3faecf"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=7a885a4e45884851e6c0a7e8dd3faecf"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=7a885a4e45884851e6c0a7e8dd3faecf"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=7a885a4e45884851e6c0a7e8dd3faecf"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=7a885a4e45884851e6c0a7e8dd3faecf"/><link as="script" rel="preload" href="/webpack-runtime-d8911cf24dddd5a4a046.js"/><link as="script" rel="preload" href="/framework-ba40f9a3aba7ac20e79d.js"/><link as="script" rel="preload" href="/app-6f56328a3e200ac2dd23.js"/><link as="script" rel="preload" href="/commons-ec1ff0196f221512f64c.js"/><link as="script" rel="preload" href="/cccf16cabe9651c8aace85f0df593a6e3ec5934f-0532524db0f95f077589.js"/><link as="script" rel="preload" href="/component---src-pages-blog-posts-05-2021-deploying-clojure-libraries-to-gitlab-maven-repository-mdx-5ca43064ec7c29a3a484.js"/><link as="fetch" rel="preload" href="/page-data/blog/posts/05-2021/deploying-clojure-libraries-to-gitlab-maven-repository/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/63159454.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-PWMZ27CHJB"></script><script>
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());

              gtag('config', 'G-PWMZ27CHJB');
                </script></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><style data-emotion-css="a2ej43">body{font-family:"Poppins",sans-serif;margin:0;}</style><div><style data-emotion-css="d3camc">.css-d3camc{margin:30px auto 0 auto;max-width:900px;padding:0 30px 140px 30px;}.css-d3camc .post__content{margin-top:60px;}.css-d3camc .post__heading{margin-bottom:10px;}.css-d3camc .post__date{font-size:14px;}.css-d3camc .syntax-highlight{padding:30px;border-radius:10px;font-family:SF Mono,sans-serif;font-size:16px;line-height:1.6em;-webkit-letter-spacing:0.5px;-moz-letter-spacing:0.5px;-ms-letter-spacing:0.5px;letter-spacing:0.5px;font-weight:100;overflow-y:scroll;}.css-d3camc code{font-family:inherit;background:#dedede;border-radius:2px;padding:0 5px;font-size:14px;}.css-d3camc a{-webkit-text-decoration:none;text-decoration:none;color:#0000ee;}.css-d3camc h1 a,.css-d3camc h2 a,.css-d3camc h3 a,.css-d3camc h4 a{color:#000;}</style><div class="css-d3camc"><style data-emotion-css="1rmcb83">.css-1rmcb83{font-size:40px;}.css-1rmcb83 a{-webkit-text-decoration:none;text-decoration:none;}</style><div class="css-1rmcb83"><a href="/">üè†</a></div><div class="post__content"><h1 class="post__heading">Deploying Clojure libraries to gitlab maven repository</h1><p class="post__date">05 June 2021</p><p>Gitlab provides an amazing package manager which supports most types of the package registries like npm, pypi, maven, etc. You can use this to manage your clojure private packages. Gitlab have an amazing documentation but it doesn&#x27;t provide any docs on how to deploy clojure packages. We are going to look how to deploy a simple clojure package to gitlab private repository. We will be using leiningen for creating, managing and deploying clojure projects.</p><h2>Creating a new clojure library</h2><p>leiningen provides an easy way to create a clojure library project. </p><pre><style data-emotion-css="cssveg">.css-cssveg{position:relative;}</style><div class="css-cssveg"><style data-emotion-css="i2yqko">.css-i2yqko{position:absolute;right:10px;top:10px;background:none;color:#fff;border:1px solid #fff;padding:5px 10px;border-radius:7px;cursor:pointer;}.css-i2yqko:focus{outline:none;border-radius:7px;border-color:#0000ee;}</style><button class="css-i2yqko">Copy</button><div class="prism-code language-bash syntax-highlight" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="token plain">lein new </span><span class="token operator" style="color:#d7deea">&lt;</span><span class="token plain">library-name</span><span class="token operator" style="color:#d7deea">&gt;</span></div></div></div></pre><p>This create a simple clojure library with a <code>project.clj</code> configuration file and <code>core.clj</code> file. Update the description, url etc. for the package in your <code>project.clj</code> file.</p><h2>Setting up gitlab deploy configuration</h2><p>To deploy the package for your terminal you will need a gitlab personal or deploy token. You can generate a personal token using this <a href="https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html">documentation</a>. If you are going with a deploy token make sure it have <code>read_package_registry</code> and <code>write_package_registry</code> scopes attached to it. To generate deploy token follow this <a href="https://docs.gitlab.com/ee/user/project/deploy_tokens/index.html">documentation</a>. Another thing you will need is the project id. You can get it from the repository home page below the repo name.</p><p>Once you have a gitlab personal or deploy token you have to set this to your <code>project.clj</code> file. leiningen provides a way to set package deploy configuration for each of the release type. You can add <code>:repositories</code> key in project.clj with the config values. So your project.clj will look like this. </p><pre><div class="css-cssveg"><button class="css-i2yqko">Copy</button><div class="prism-code language-clojure syntax-highlight" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="token plain">(defproject my-package &quot;0.1.0-SNAPSHOT&quot;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  :description &quot;&lt;description&gt;&quot;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  :url &quot;&lt;repo_url&gt;&quot;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  :license {:name &quot;EPL-2.0&quot;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">            :url &quot;https://www.eclipse.org/legal/epl-2.0/&quot;}</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  :dependencies [[org.clojure/clojure &quot;1.10.0&quot;]]</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  :repl-options {:init-ns my-package.core}</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">  :repositories [[&quot;releases&quot;  {:url           &quot;https://gitlab.com/api/v4/projects/&lt;project-id&gt;/packages/maven&quot;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">                               :username      &quot;Private-Token&quot;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">                               :password      &quot;&lt;personal | deploy token&gt;&quot;}</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">                                    &quot;snapshots&quot; {:url           &quot;https://gitlab.com/api/v4/projects/&lt;project-id&gt;/packages/maven&quot;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">                               :username      &quot;Private-Token&quot;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">                               :password      &quot;&lt;personal | deploy token&gt;&quot;}]])</span></div></div></div></pre><p>You will need to add two configurations to the <code>:repositories</code> field. The <code>snapshots</code> config will be used for snapshot release and the <code>releases</code> config will be used for the major releases.</p><h2>Deploying the package</h2><p>It is time to deploy your package to gitlab. Run the lein deploy command. </p><pre><div class="css-cssveg"><button class="css-i2yqko">Copy</button><div class="prism-code language-bash syntax-highlight" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="token plain">lein deploy</span></div></div></div></pre><p>This will deploy the packages to gitlab package registry. You can see it by going to the repo page and selecting <code>Package Registry</code> from the <code>Packages &amp; Registries</code> tab in the sidebar.</p><h2>Securing the deploy tokens</h2><p>In the last step we have hardcoded the personal or deploy token in the <code>project.clj</code> but for an actual project it is not secure to hardcode some credentials in a file we add to git. To secure it we can set an environment variable with the token and load that in our project.clj.</p><p>To pull the token from an environment variable to the project.clj we can use <code>(System/getenv)</code> function. By replacing the token with this function, the project.clj will look like</p><pre><div class="css-cssveg"><button class="css-i2yqko">Copy</button><div class="prism-code language-clojure syntax-highlight" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="token plain">:repositories [[&quot;releases&quot;  {:url           &quot;https://gitlab.com/api/v4/projects/&lt;project-id&gt;/packages/maven&quot;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">                             :username      &quot;Private-Token&quot;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">                             :password      ~(System/getenv &quot;GITLAB_DEPLOY_TOKEN&quot;)}</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">                              &quot;snapshots&quot; {:url           &quot;https://gitlab.com/api/v4/projects/&lt;project-id&gt;/packages/maven&quot;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">                             :username      &quot;Private-Token&quot;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">                             :password      ~(System/getenv &quot;GITLAB_DEPLOY_TOKEN&quot;)}]]</span></div></div></div></pre><p>Now we have a clojure package deployed to gitlab package registry. Happy Coding! </p></div></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/posts/05-2021/deploying-clojure-libraries-to-gitlab-maven-repository/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-4555a3ffd01866d5d0f3.js"],"app":["/app-6f56328a3e200ac2dd23.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-1f11b520a037696f6a01.js"],"component---src-pages-blog-posts-05-2021-deploying-clojure-libraries-to-gitlab-maven-repository-mdx":["/component---src-pages-blog-posts-05-2021-deploying-clojure-libraries-to-gitlab-maven-repository-mdx-5ca43064ec7c29a3a484.js"],"component---src-pages-blog-posts-11-2020-how-i-created-this-blog-mdx":["/component---src-pages-blog-posts-11-2020-how-i-created-this-blog-mdx-2805791ee9a827bb1b0c.js"],"component---src-pages-blog-posts-11-2020-how-thirdparty-integrations-inject-components-p-1-mdx":["/component---src-pages-blog-posts-11-2020-how-thirdparty-integrations-inject-components-p-1-mdx-23eeaf10a3c52c205f60.js"],"component---src-pages-blog-tsx":["/component---src-pages-blog-tsx-2223e1ed11917b3dbb0f.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-f13fdffc131cd070957e.js"],"component---src-pages-projects-tsx":["/component---src-pages-projects-tsx-dc9236f38c08ecb4fb60.js"],"component---src-pages-resume-tsx":["/component---src-pages-resume-tsx-10937c6a44f427b631b6.js"]};/*]]>*/</script><script src="/polyfill-4555a3ffd01866d5d0f3.js" nomodule=""></script><script src="/component---src-pages-blog-posts-05-2021-deploying-clojure-libraries-to-gitlab-maven-repository-mdx-5ca43064ec7c29a3a484.js" async=""></script><script src="/cccf16cabe9651c8aace85f0df593a6e3ec5934f-0532524db0f95f077589.js" async=""></script><script src="/commons-ec1ff0196f221512f64c.js" async=""></script><script src="/app-6f56328a3e200ac2dd23.js" async=""></script><script src="/framework-ba40f9a3aba7ac20e79d.js" async=""></script><script src="/webpack-runtime-d8911cf24dddd5a4a046.js" async=""></script></body></html>